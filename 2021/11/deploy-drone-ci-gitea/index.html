<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><meta http-equiv=x-ua-compatible content="IE=edge, chrome=1"><title>让 Gitea 支持 Drone 持续集成工具 - 豆浆的博客</title><meta name=Description content="豆浆的博客"><meta property="og:title" content="让 Gitea 支持 Drone 持续集成工具"><meta property="og:description" content="简介 Drone 是一个现代的持续集成工具 Drone by Harness™ is a modern Continuous Integration platform that empowers busy teams to automate their build, test and release workflows using a powerful, cloud native pipeline engine. 这几天心血来潮, 在自己的服务器上部署了一"><meta property="og:type" content="article"><meta property="og:url" content="https://blog.lomot.cn/2021/11/deploy-drone-ci-gitea/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2021-11-20T10:53:56+08:00"><meta property="article:modified_time" content="2022-02-03T15:56:17+08:00"><meta property="og:site_name" content="豆浆的博客"><meta name=twitter:card content="summary"><meta name=twitter:title content="让 Gitea 支持 Drone 持续集成工具"><meta name=twitter:description content="简介 Drone 是一个现代的持续集成工具 Drone by Harness™ is a modern Continuous Integration platform that empowers busy teams to automate their build, test and release workflows using a powerful, cloud native pipeline engine. 这几天心血来潮, 在自己的服务器上部署了一"><meta name=application-name content="豆浆的博客"><meta name=apple-mobile-web-app-title content="豆浆的博客"><meta name=theme-color content="#ffffff"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://blog.lomot.cn/2021/11/deploy-drone-ci-gitea/><link rel=prev href=https://blog.lomot.cn/2021/08/vscode-remote-environment-bug/><link rel=next href=https://blog.lomot.cn/2022/01/use-restic-to-backup/><link rel=stylesheet href=https://static-1251996892.file.myqcloud.com/LoveItLib_0.2.10/normalize.css@8.0.1/normalize.min.css><link rel=stylesheet href=/css/style.min.css><link rel=stylesheet href=https://static-1251996892.file.myqcloud.com/LoveItLib_0.2.10/@fortawesome/fontawesome-free@5.13.0/css/all.min.css><link rel=stylesheet href=https://static-1251996892.file.myqcloud.com/LoveItLib_0.2.10/animate.css@3.7.2/animate.min.css><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"让 Gitea 支持 Drone 持续集成工具","inLanguage":"zh-CN","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/blog.lomot.cn\/2021\/11\/deploy-drone-ci-gitea\/"},"genre":"posts","keywords":"Drone, Gitea, ci","wordcount":826,"url":"https:\/\/blog.lomot.cn\/2021\/11\/deploy-drone-ci-gitea\/","datePublished":"2021-11-20T10:53:56+08:00","dateModified":"2022-02-03T15:56:17+08:00","license":"This work is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License.","publisher":{"@type":"Organization","name":"lomot"},"author":{"@type":"Person","name":"lomot"},"description":""}</script></head><body header-desktop=fixed header-mobile=auto><script type=text/javascript>(window.localStorage&&localStorage.getItem("theme")?localStorage.getItem("theme")==="dark":"auto"==="auto"?window.matchMedia("(prefers-color-scheme: dark)").matches:"auto"==="dark")&&document.body.setAttribute("theme","dark")</script><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title=豆浆的博客>豆浆的博客</a></div><div class=menu><div class=menu-inner><a class=menu-item href=/posts/>所有文章 </a><a class=menu-item href=/tags/>标签 </a><a class=menu-item href=/categories/>分类 </a><a class=menu-item href=/about/>关于 </a><span class="menu-item delimiter"></span><a href=javascript:void(0); class="menu-item theme-switch" title=切换主题>
<i class="fas fa-adjust fa-fw"></i></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title=豆浆的博客>豆浆的博客</a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><a class=menu-item href=/posts/ title>所有文章</a><a class=menu-item href=/tags/ title>标签</a><a class=menu-item href=/categories/ title>分类</a><a class=menu-item href=/about/ title>关于</a><a href=javascript:void(0); class="menu-item theme-switch" title=切换主题>
<i class="fas fa-adjust fa-fw"></i></a></div></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=main><div class=container><div class=toc id=toc-auto><h2 class=toc-title>目录</h2><div class=toc-content id=toc-content-auto></div></div><article class="page single"><h1 class="single-title animated flipInX">让 Gitea 支持 Drone 持续集成工具</h1><div class=post-meta><div class=post-meta-line><span class=post-author><a href=/ title=Author rel=author class=author><i class="fas fa-user-circle fa-fw"></i>lomot</a></span></div><div class=post-meta-line><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime=2021-11-20>2021-11-20</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;约 826 字&nbsp;
<i class="far fa-clock fa-fw"></i>&nbsp;预计阅读 2 分钟&nbsp;<span id=/2021/11/deploy-drone-ci-gitea/ class=leancloud_visitors data-flag-title="让 Gitea 支持 Drone 持续集成工具">
<i class="far fa-eye fa-fw"></i>&nbsp;<span class=leancloud-visitors-count></span>&nbsp;次阅读
</span>&nbsp;</div></div><div class="details toc" id=toc-static kept><div class="details-summary toc-title"><span>目录</span>
<span><i class="details-icon fas fa-angle-right"></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#简介>简介</a></li><li><a href=#让我们开始吧>让我们开始吧!</a><ul><li><a href=#在-gitea-上创建-oauth2-application>在 gitea 上创建 OAuth2 Application</a></li><li><a href=#部署-drone>部署 Drone</a></li><li><a href=#启用-drone-runner-exec>启用 drone-runner-exec</a></li></ul></li><li><a href=#测试>测试</a><ul><li><a href=#创建一个新的golang项目test-drone>创建一个新的<code>golang</code>项目<code>test-drone</code></a></li><li><a href=#编写droneyml文件>编写<code>.drone.yml</code>文件</a></li><li><a href=#结果>结果</a></li></ul></li><li><a href=#link>link</a></li></ul></nav></div></div><div class=content id=content><h2 id=简介>简介</h2><p>Drone 是一个现代的持续集成工具</p><blockquote><p>Drone by Harness™ is a modern Continuous Integration platform that empowers busy teams to automate their build, test and release workflows using a powerful, cloud native pipeline engine.</p></blockquote><p>这几天心血来潮, 在自己的服务器上部署了一个<code>Drone</code>, 配合很久以前自己搭建的<code>Gitea</code>私有 git 仓库一起使用</p><h2 id=让我们开始吧>让我们开始吧!</h2><h3 id=在-gitea-上创建-oauth2-application>在 gitea 上创建 OAuth2 Application</h3><p><img class=lazyload src=/svg/loading.min.svg data-src=https://static-1251996892.file.myqcloud.com/img/markdown/2021/gitea-create-oauth2-app.png data-srcset="https://static-1251996892.file.myqcloud.com/img/markdown/2021/gitea-create-oauth2-app.png, https://static-1251996892.file.myqcloud.com/img/markdown/2021/gitea-create-oauth2-app.png 1.5x, https://static-1251996892.file.myqcloud.com/img/markdown/2021/gitea-create-oauth2-app.png 2x" data-sizes=auto alt=https://static-1251996892.file.myqcloud.com/img/markdown/2021/gitea-create-oauth2-app.png title=gitea-create-oauth2-app></p><p>记下生成的<code>client id</code> 和<code>client key</code>, 后面要用</p><h3 id=部署-drone>部署 Drone</h3><p>我使用了 drone 推荐的容器部署方式, 官方直接用了<code>docker run</code>, 我改用<code>docker-compose</code>, 并且把<code>drone</code>和 <code>drone-runner-docker</code> 放到了一起</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yml data-lang=yml><span class=line><span class=cl><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;3&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>services</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>drone</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>container_name</span><span class=p>:</span><span class=w> </span><span class=l>drone</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>drone/drone:2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>./drone:/data</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=m>8041</span><span class=p>:</span><span class=m>80</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>environment</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>DRONE_GITEA_SERVER</span><span class=p>:</span><span class=w> </span><span class=l>https://git.yourdomain.com</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>DRONE_GITEA_CLIENT_ID</span><span class=p>:</span><span class=w> </span><span class=l>05136e57d80189bef462</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>DRONE_GITEA_CLIENT_SECRET</span><span class=p>:</span><span class=w> </span><span class=l>7c229228a77d2cbddaa61ddc78d45e</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>DRONE_RPC_SECRET</span><span class=p>:</span><span class=w> </span><span class=l>super-duper-secret</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>DRONE_SERVER_HOST</span><span class=p>:</span><span class=w> </span><span class=l>drone.yourdomain.com</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>DRONE_SERVER_PROTO</span><span class=p>:</span><span class=w> </span><span class=l>https</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>restart</span><span class=p>:</span><span class=w> </span><span class=l>always</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>drone-runner-docker</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>container_name</span><span class=p>:</span><span class=w> </span><span class=l>drone-runner-docker</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>drone/drone-runner-docker:1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>/var/run/docker.sock:/var/run/docker.sock</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>environment</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>DRONE_RPC_PROTO</span><span class=p>:</span><span class=w> </span><span class=l>https</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>DRONE_RPC_HOST</span><span class=p>:</span><span class=w> </span><span class=l>drone.yourdomain.com</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>DRONE_RPC_SECRET</span><span class=p>:</span><span class=w> </span><span class=l>super-duper-secret</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>DRONE_RUNNER_CAPACITY</span><span class=p>:</span><span class=w> </span><span class=m>2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>DRONE_RUNNER_NAME</span><span class=p>:</span><span class=w> </span><span class=l>drone-runner</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>restart</span><span class=p>:</span><span class=w> </span><span class=l>always</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>上面的环境变量我就直接贴出官网的解释了</p><ul><li>drone</li></ul><blockquote><p>DRONE_GITEA_CLIENT_ID<br>Required string value provides your Gitea oauth Client ID.<br>DRONE_GITEA_CLIENT_SECRET<br>Required string value provides your Gitea oauth Client Secret.<br>DRONE_GITEA_SERVER<br>Required string value provides your Gitea server address. For example <a href=https://gitea.company.com target=_blank rel="noopener noreffer">https://gitea.company.com</a>, note the http(s) otherwise you’ll see an error with “unsupported protocol scheme” from Gitea.<br>DRONE_GIT_ALWAYS_AUTH<br>Optional boolean value configures Drone to authenticate when cloning public repositories.<br>DRONE_RPC_SECRET<br>Required string value provides the shared secret generated in the previous step. This is used to authenticate the rpc connection between the server and runners. The server and runner must be provided the same secret value.<br>DRONE_SERVER_HOST<br>Required string value provides your external hostname or IP address. If using an IP address you may include the port. For example drone.company.com.<br>DRONE_SERVER_PROTO<br>Required string value provides your external protocol scheme. This value should be set to http or https. This field defaults to https if you configure ssl or acme.</p></blockquote><ul><li>drone-runner-docker</li></ul><blockquote><p>DRONE_RPC_HOST<br>provides the hostname (and optional port) of your Drone server. The runner connects to the server at the host address to receive pipelines for execution.<br>DRONE_RPC_PROTO<br>provides the protocol used to connect to your Drone server. The value must be either http or https.<br>DRONE_RPC_SECRET<br>provides the shared secret used to authenticate with your Drone server. This must match the secret defined in your Drone server configuration.</p></blockquote><h3 id=启用-drone-runner-exec>启用 drone-runner-exec</h3><p>drone-runner-exec 用于在宿主机直接执行脚本, 需要独立安装</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>curl -L https://github.com/drone-runners/drone-runner-exec/releases/latest/download/drone_runner_exec_linux_amd64.tar.gz <span class=p>|</span> tar zx
</span></span><span class=line><span class=cl>sudo install -t /usr/local/bin drone-runner-exec
</span></span><span class=line><span class=cl>sudo mkdir /var/log/drone-runner-exec
</span></span><span class=line><span class=cl>sudo mkdir /etc/drone-runner-exec
</span></span><span class=line><span class=cl>sudo vim /etc/drone-runner-exec/config
</span></span></code></pre></td></tr></table></div></div><p><code>/etc/drone-runner-exec/config</code> :</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl><span class=nv>DRONE_RPC_PROTO</span><span class=o>=</span>https
</span></span><span class=line><span class=cl><span class=nv>DRONE_RPC_HOST</span><span class=o>=</span>drone.company.com
</span></span><span class=line><span class=cl><span class=nv>DRONE_RPC_SECRET</span><span class=o>=</span>super-duper-secret
</span></span><span class=line><span class=cl><span class=nv>DRONE_LOG_FILE</span><span class=o>=</span>/var/log/drone-runner-exec/log.txt
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>drone-runner-exec service install
</span></span><span class=line><span class=cl>drone-runner-exec service start
</span></span><span class=line><span class=cl>sudo systemctl <span class=nb>enable</span> drone-runner-exec
</span></span></code></pre></td></tr></table></div></div><h2 id=测试>测试</h2><h3 id=创建一个新的golang项目test-drone>创建一个新的<code>golang</code>项目<code>test-drone</code></h3><p><code>main.go</code>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>main</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=s>&#34;log&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>log</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;hello drone&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=编写droneyml文件>编写<code>.drone.yml</code>文件</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yml data-lang=yml><span class=line><span class=cl><span class=c># go 测试</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nn>---</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>pipeline</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>docker</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>go test</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>steps</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>test</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>golang:1.16</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>pull</span><span class=p>:</span><span class=w> </span><span class=l>if-not-exists</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>commands</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>go test</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>go build</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># push image</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># 这里向本地私有仓库推送了一个镜像, 因此要使用 insecure: true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nn>---</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>pipeline</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>docker</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>push image</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>steps</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>publish</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>plugins/docker</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>pull</span><span class=p>:</span><span class=w> </span><span class=l>if-not-exists</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>settings</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>registry</span><span class=p>:</span><span class=w> </span><span class=m>192.168.7.20</span><span class=p>:</span><span class=m>5000</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>insecure</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>repo</span><span class=p>:</span><span class=w> </span><span class=m>192.168.7.20</span><span class=p>:</span><span class=m>5000</span><span class=l>/lomot/test-drone</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>tags</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>latest, 1.0, 1]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># exec cmd</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nn>---</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>pipeline</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>exec</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>test exec</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>platform</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>os</span><span class=p>:</span><span class=w> </span><span class=l>linux</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>arch</span><span class=p>:</span><span class=w> </span><span class=l>amd64</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>steps</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>test-exec</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>commands</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>echo test runner exec</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h3 id=结果>结果</h3><p><img class=lazyload src=/svg/loading.min.svg data-src=https://static-1251996892.file.myqcloud.com/img/markdown/2021/drone-test-build-img.png data-srcset="https://static-1251996892.file.myqcloud.com/img/markdown/2021/drone-test-build-img.png, https://static-1251996892.file.myqcloud.com/img/markdown/2021/drone-test-build-img.png 1.5x, https://static-1251996892.file.myqcloud.com/img/markdown/2021/drone-test-build-img.png 2x" data-sizes=auto alt=https://static-1251996892.file.myqcloud.com/img/markdown/2021/drone-test-build-img.png title=drone-test-build-img></p><p><img class=lazyload src=/svg/loading.min.svg data-src=https://static-1251996892.file.myqcloud.com/img/markdown/2021/drone-test-build-log.png data-srcset="https://static-1251996892.file.myqcloud.com/img/markdown/2021/drone-test-build-log.png, https://static-1251996892.file.myqcloud.com/img/markdown/2021/drone-test-build-log.png 1.5x, https://static-1251996892.file.myqcloud.com/img/markdown/2021/drone-test-build-log.png 2x" data-sizes=auto alt=https://static-1251996892.file.myqcloud.com/img/markdown/2021/drone-test-build-log.png title=drone-test-build-log></p><h2 id=link>link</h2><p><a href=https://docs.drone.io/server/provider/gitea/ target=_blank rel="noopener noreffer">https://docs.drone.io/server/provider/gitea/</a></p><p><a href=https://docs.drone.io/runner/exec/installation/linux/ target=_blank rel="noopener noreffer">https://docs.drone.io/runner/exec/installation/linux/</a></p></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>更新于 2022-02-03&nbsp;<a class=git-hash href=https://github.com/dillonzq/LoveIt/commit/d1bbeae9ad1bf80a5f825db76ebcff17c0d222e5 target=_blank title="commit by lomot(lomot@qq.com) d1bbeae9ad1bf80a5f825db76ebcff17c0d222e5: use slug; rename all post url">
<i class="fas fa-hashtag fa-fw"></i>d1bbeae</a></span></div><div class=post-info-license></div></div><div class=post-info-line><div class=post-info-md></div><div class=post-info-share><span><a href=javascript:void(0); title="分享到 Twitter" data-sharer=twitter data-url=https://blog.lomot.cn/2021/11/deploy-drone-ci-gitea/ data-title="让 Gitea 支持 Drone 持续集成工具" data-via=lomotco data-hashtags=Drone,Gitea,ci><i class="fab fa-twitter fa-fw"></i></a><a href=javascript:void(0); title="分享到 Facebook" data-sharer=facebook data-url=https://blog.lomot.cn/2021/11/deploy-drone-ci-gitea/ data-hashtag=Drone><i class="fab fa-facebook-square fa-fw"></i></a><a href=javascript:void(0); title="分享到 微博" data-sharer=weibo data-url=https://blog.lomot.cn/2021/11/deploy-drone-ci-gitea/ data-title="让 Gitea 支持 Drone 持续集成工具" data-ralateuid=5676214854><i class="fab fa-weibo fa-fw"></i></a><a href=javascript:void(0); title="分享到 人人" data-sharer=renren data-url=https://blog.lomot.cn/2021/11/deploy-drone-ci-gitea/><i class="fab fa-renren fa-fw"></i></a><a href=javascript:void(0); title="分享到 Evernote" data-sharer=evernote data-url=https://blog.lomot.cn/2021/11/deploy-drone-ci-gitea/ data-title="让 Gitea 支持 Drone 持续集成工具"><i class="fab fa-evernote fa-fw"></i></a></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fas fa-tags fa-fw"></i>&nbsp;<a href=/tags/drone/>Drone</a>,&nbsp;<a href=/tags/gitea/>Gitea</a>,&nbsp;<a href=/tags/ci/>ci</a></section><section><span><a href=javascript:void(0); onclick=window.history.back()>返回</a></span>&nbsp;|&nbsp;<span><a href=/>主页</a></span></section></div><div class=post-nav><a href=/2021/08/vscode-remote-environment-bug/ class=prev rel=prev title=Vscode-ssh远程开发PATH环境变量不能自动刷新的bug><i class="fas fa-angle-left fa-fw"></i>Vscode-ssh远程开发PATH环境变量不能自动刷新的bug</a>
<a href=/2022/01/use-restic-to-backup/ class=next rel=next title="使用 Restic 备份服务器数据">使用 Restic 备份服务器数据<i class="fas fa-angle-right fa-fw"></i></a></div></div><div id=comments><div id=valine class=comment></div><noscript>Please enable JavaScript to view the comments powered by <a href=https://valine.js.org/>Valine</a>.</noscript></div></article></div></main><footer class=footer><div class=footer-container><div class=footer-line>由 <a href=https://gohugo.io/ target=_blank rel="noopener noreffer" title="Hugo 0.101.0">Hugo</a> 强力驱动 | 主题 - <a href=https://github.com/dillonzq/LoveIt target=_blank rel="noopener noreffer" title="LoveIt 0.2.10"><i class="far fa-kiss-wink-heart fa-fw"></i> LoveIt</a></div><div class=footer-line><i class="far fa-copyright fa-fw"></i><span itemprop=copyrightYear>2016 - 2022</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=/ target=_blank>lomot</a></span>&nbsp;|&nbsp;<span class=license><a rel="license external nofollow noopener noreffer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span><span class=icp-splitter>&nbsp;|&nbsp;</span><br class=icp-br><span class=icp><a href=http://beian.miit.gov.cn target=_blank class=text rel=nofollow>皖ICP备20012790号-1</a></span></div></div></footer></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title=回到顶部><i class="fas fa-arrow-up fa-fw"></i>
</a><a href=# id=view-comments class=fixed-button title=查看评论><i class="fas fa-comment fa-fw"></i></a></div><link rel=stylesheet href=/lib/valine/valine.min.css><link rel=stylesheet href=https://static-1251996892.file.myqcloud.com/LoveItLib_0.2.10/lightgallery.js@1.2.0/dist/css/lightgallery.min.css><script type=text/javascript src=https://static-1251996892.file.myqcloud.com/LoveItLib_0.2.10/valine@1.4.14/dist/Valine.min.js></script><script type=text/javascript src=https://static-1251996892.file.myqcloud.com/LoveItLib_0.2.10/smooth-scroll@16.1.3/dist/smooth-scroll.min.js></script><script type=text/javascript src=https://static-1251996892.file.myqcloud.com/LoveItLib_0.2.10/lazysizes@5.2.2/lazysizes.min.js></script><script type=text/javascript src=https://static-1251996892.file.myqcloud.com/LoveItLib_0.2.10/lightgallery.js@1.2.0/dist/js/lightgallery.min.js></script><script type=text/javascript src=https://static-1251996892.file.myqcloud.com/LoveItLib_0.2.10/lg-thumbnail.js@1.2.0/dist/lg-thumbnail.min.js></script><script type=text/javascript src=https://static-1251996892.file.myqcloud.com/LoveItLib_0.2.10/lg-zoom.js@1.2.0/dist/lg-zoom.min.js></script><script type=text/javascript src=https://static-1251996892.file.myqcloud.com/LoveItLib_0.2.10/clipboard@2.0.6/dist/clipboard.min.js></script><script type=text/javascript src=https://static-1251996892.file.myqcloud.com/LoveItLib_0.2.10/sharer.js@0.4.0/sharer.min.js></script><script type=text/javascript>window.config={code:{copyTitle:"复制到剪贴板",maxShownLines:1e3},comment:{valine:{appId:"I7PtpjsuKSpR2qhMaq7JJXQt-MdYXbMMI",appKey:"B9kjrXLA5NJLrUT0PhLfPb2n",avatar:"mp",el:"#valine",emojiCDN:"https://cdn.jsdelivr.net/npm/emoji-datasource-google@5.0.1/img/google/64/",emojiMaps:{100:"1f4af.png",alien:"1f47d.png",anger:"1f4a2.png",angry:"1f620.png",anguished:"1f627.png",astonished:"1f632.png",black_heart:"1f5a4.png",blue_heart:"1f499.png",blush:"1f60a.png",bomb:"1f4a3.png",boom:"1f4a5.png",broken_heart:"1f494.png",brown_heart:"1f90e.png",clown_face:"1f921.png",cold_face:"1f976.png",cold_sweat:"1f630.png",confounded:"1f616.png",confused:"1f615.png",cry:"1f622.png",crying_cat_face:"1f63f.png",cupid:"1f498.png",dash:"1f4a8.png",disappointed:"1f61e.png",disappointed_relieved:"1f625.png",dizzy:"1f4ab.png",dizzy_face:"1f635.png",drooling_face:"1f924.png",exploding_head:"1f92f.png",expressionless:"1f611.png",face_vomiting:"1f92e.png",face_with_cowboy_hat:"1f920.png",face_with_hand_over_mouth:"1f92d.png",face_with_head_bandage:"1f915.png",face_with_monocle:"1f9d0.png",face_with_raised_eyebrow:"1f928.png",face_with_rolling_eyes:"1f644.png",face_with_symbols_on_mouth:"1f92c.png",face_with_thermometer:"1f912.png",fearful:"1f628.png",flushed:"1f633.png",frowning:"1f626.png",ghost:"1f47b.png",gift_heart:"1f49d.png",green_heart:"1f49a.png",grimacing:"1f62c.png",grin:"1f601.png",grinning:"1f600.png",hankey:"1f4a9.png",hear_no_evil:"1f649.png",heart:"2764-fe0f.png",heart_decoration:"1f49f.png",heart_eyes:"1f60d.png",heart_eyes_cat:"1f63b.png",heartbeat:"1f493.png",heartpulse:"1f497.png",heavy_heart_exclamation_mark_ornament:"2763-fe0f.png",hole:"1f573-fe0f.png",hot_face:"1f975.png",hugging_face:"1f917.png",hushed:"1f62f.png",imp:"1f47f.png",innocent:"1f607.png",japanese_goblin:"1f47a.png",japanese_ogre:"1f479.png",joy:"1f602.png",joy_cat:"1f639.png",kiss:"1f48b.png",kissing:"1f617.png",kissing_cat:"1f63d.png",kissing_closed_eyes:"1f61a.png",kissing_heart:"1f618.png",kissing_smiling_eyes:"1f619.png",laughing:"1f606.png",left_speech_bubble:"1f5e8-fe0f.png",love_letter:"1f48c.png",lying_face:"1f925.png",mask:"1f637.png",money_mouth_face:"1f911.png",nauseated_face:"1f922.png",nerd_face:"1f913.png",neutral_face:"1f610.png",no_mouth:"1f636.png",open_mouth:"1f62e.png",orange_heart:"1f9e1.png",partying_face:"1f973.png",pensive:"1f614.png",persevere:"1f623.png",pleading_face:"1f97a.png",pouting_cat:"1f63e.png",purple_heart:"1f49c.png",rage:"1f621.png",relaxed:"263a-fe0f.png",relieved:"1f60c.png",revolving_hearts:"1f49e.png",right_anger_bubble:"1f5ef-fe0f.png",robot_face:"1f916.png",rolling_on_the_floor_laughing:"1f923.png",scream:"1f631.png",scream_cat:"1f640.png",see_no_evil:"1f648.png",shushing_face:"1f92b.png",skull:"1f480.png",skull_and_crossbones:"2620-fe0f.png",sleeping:"1f634.png",sleepy:"1f62a.png",slightly_frowning_face:"1f641.png",slightly_smiling_face:"1f642.png",smile:"1f604.png",smile_cat:"1f638.png",smiley:"1f603.png",smiley_cat:"1f63a.png",smiling_face_with_3_hearts:"1f970.png",smiling_imp:"1f608.png",smirk:"1f60f.png",smirk_cat:"1f63c.png",sneezing_face:"1f927.png",sob:"1f62d.png",space_invader:"1f47e.png",sparkling_heart:"1f496.png",speak_no_evil:"1f64a.png",speech_balloon:"1f4ac.png","star-struck":"1f929.png",stuck_out_tongue:"1f61b.png",stuck_out_tongue_closed_eyes:"1f61d.png",stuck_out_tongue_winking_eye:"1f61c.png",sunglasses:"1f60e.png",sweat:"1f613.png",sweat_drops:"1f4a6.png",sweat_smile:"1f605.png",thinking_face:"1f914.png",thought_balloon:"1f4ad.png",tired_face:"1f62b.png",triumph:"1f624.png",two_hearts:"1f495.png",unamused:"1f612.png",upside_down_face:"1f643.png",weary:"1f629.png",white_frowning_face:"2639-fe0f.png",white_heart:"1f90d.png",wink:"1f609.png",woozy_face:"1f974.png",worried:"1f61f.png",yawning_face:"1f971.png",yellow_heart:"1f49b.png",yum:"1f60b.png",zany_face:"1f92a.png",zipper_mouth_face:"1f910.png",zzz:"1f4a4.png"},enableQQ:!1,highlight:!0,lang:"zh-cn",pageSize:10,placeholder:"来写评论吧 ...",recordIP:!0,visitor:!0}},lightGallery:{actualSize:!1,exThumbImage:"data-thumbnail",hideBarsDelay:2e3,selector:".lightgallery",speed:400,thumbContHeight:80,thumbWidth:80,thumbnail:!0}}</script><script type=text/javascript src=/js/theme.min.js></script></body></html>